<html>
  <head>
    <link rel="stylesheet" , href="https://unpkg.com/mvp.css" />
    <script type="module">
      import { Euphony } from "https://cdn.jsdelivr.net/gh/euphony-io/euphony.js/dist/euphony.m.min.js";
      var euphy = new Euphony();
      var btnSwt = false;

      window.generateSoundData = function () {
        if (btnSwt) {
          euphy.stop();
          document.getElementById("euphy_btn").value = "broadcast";
          btnSwt = false;
          console.log("STOP!");
        } else {
          var code = document.getElementById("euphy_text");
          euphy.setCode(code.value);
          euphy.play();
          document.getElementById("euphy_btn").value = "stop";
          btnSwt = true;
          console.log("PLAY!");
        }
      };

      let desc = window.document.getElementById("desc");
      if (!euphy.isAudioWorkletAvailable) {
        desc.innerHTML += "AudioWorklet is not supported.<br/>";
      }
    </script>
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>
    <p id="server-time"></p>
    <div id="customerSide">
      <div style="display: flex; justify-content: center">
        <form
          id="customerTransmitter"
          style="display: flex; flex-direction: column"
        >
          <div>제품명</div>
          <input
            class="customerTransmitter_name"
            type="text"
            placeholder="Type product name"
            style="width: 100%"
            required
          />
          <div>제품 가격</div>
          <div style="display: flex; position: relative">
            <input
              class="customerTransmitter_price"
              type="number"
              placeholder="Type product price"
              style="width: 100%"
              required
            />
            <div
              style="
                position: absolute;
                color: black;
                right: 10px;
                margin-top: 4px;
              "
            >
              원
            </div>
          </div>
          <button>발신하기</button>
        </form>
      </div>
    </div>
    <div id="showcardSide">
      <center>
        <h1>Hi, this is the Euphony's ES6 demo project.</h1>
        <p>
          <input
            id="euphy_text"
            class="demo_text_edit"
            type="text"
            value="hello, euphony"
          />
          <input
            id="euphy_btn"
            class="demo_btn"
            type="button"
            value="broadcast"
            onclick="generateSoundData()"
          />
        </p>
        <div id="desc"><strong>Description</strong><br /></div>
      </center>
    </div>
    <div id="btnContainer">
      <div style="width: 100%; display: flex; justify-content: center">
        <div>
          <div>
            <button class="customerSide_btn">Customer Side</button>
          </div>
          <div>
            <button class="showcardSide_btn">Showcard Side</button>
          </div>
        </div>
      </div>
    </div>
    <script>
      let socket = io();
      let el;

      const customerTransmitter = document.querySelector(
        "#customerTransmitter"
      );
      const customerSide = document.getElementById("customerSide");
      const showcardSide = document.getElementById("showcardSide");
      const btnContainer = document.getElementById("btnContainer");
      const customerBtn = document.querySelector(".customerSide_btn");
      const showcardBtn = document.querySelector(".showcardSide_btn");

      const euphonyInput = document.querySelector("#euphy_text");

      function openPage(event) {
        const currentPage = event.target.innerText;
        if (currentPage === "Customer Side") {
          customerSide.hidden = false;
          btnContainer.hidden = true;
        } else if (currentPage === "Showcard Side") {
          showcardSide.hidden = false;
          btnContainer.hidden = true;
        }
      }

      function handleSubmit(event) {
        event.preventDefault();
        const name = customerTransmitter.querySelector(
          ".customerTransmitter_name"
        );
        const price = customerTransmitter.querySelector(
          ".customerTransmitter_price"
        );
        socket.emit("setData", { name: name.value, price: price.value });
        name.value = "";
        price.value = "";
      }

      customerBtn.addEventListener("click", openPage);
      showcardBtn.addEventListener("click", openPage);
      customerTransmitter.addEventListener("submit", handleSubmit);

      socket.addEventListener("open", () => console.log("open"));
      socket.addEventListener("close", () => {
        console.log("Disconnected from Server ❌");
      });

      socket.on("time", (timeString) => {
        el = document.getElementById("server-time");
        el.innerHTML = "Server time: " + timeString;
      });

      socket.on("setShowCardData", (setData) => {
        euphonyInput.value = setData.name;
      });

      customerSide.hidden = true;
      showcardSide.hidden = true;
    </script>
  </body>
</html>
